<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/wired-card/wired-card.html">
<link rel="import" href="/bower_components/wired-button/wired-button.html">
<link rel="import" href="/bower_components/marked-element/marked-element.html">
<link rel="stylesheet" type="text/css" href="/demo/fonts/fonts.css" />

<dom-module id="feed-item">
  <template>
    <style>
      :host {
        display: inline-block;
      }

      wired-card {
        font-family: 'futurahandwrittenmedium', sans-serif;
        align-content: center;
        width: 200px; 
        height: 250px; 
        display: inline-block;
        padding: 20px;
        margin: 5px;
        position: relative;
      }

      marked-element {
        position: absolute;
        top: 10px;
      }

      .buttons {
        position: absolute;
        bottom: 10px;
        margin: auto;
        width: 80%;
        display: flex;
        justify-content: space-between;
      }

      img {
        width: 90%;
      }

    </style>
    <wired-card id="card">
      <marked-element id="marked">
        <div slot="markdown-html"></div>
        <script type="text/markdown" src$="markdown/[[item.markdownId]].md"></script>
      </marked-element>

      <div class="buttons">
        <wired-button text="Like" on-click="_clickHandler"></wired-button>
        <wired-button on-click="_clickHandler" text="Comment"></wired-button>
        <wired-button on-click="_clickHandler" text="Share"></wired-button>
      </div>

    </wired-card>

  </template>

  <script>
    /**
     * `feed-item`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class FeedItem extends Polymer.Element {
      static get is() { return 'feed-item'; }
      static get properties() {
        return {
          item: {
            type: Object
          },
          markdownId: {
            type: String,
            observer: '_markdownIdChanged'
          }
        };
      }

      connectedCallback() {
        super.connectedCallback(); 
        this._updateCardStyles();
      }

      _clickHandler(event) {
        let action = event.target.text.toLowerCase();
        let feed = this.parentNode.host; 
        let likelihoodIncrease = this.item.likelihoodIncrease;
        feed.dispatchEvent(new CustomEvent('action', {detail: {likelihoodIncrease: likelihoodIncrease, 
          category: this.item.category}, bubbles: true}));
      }

      _markdownIdChanged(newId, oldId) {
        this._updateCardStyles();
      }

      _updateCardStyles() {
        // TODO (ellen): actually implement this
        // debugger;
        // let markedHeight = this.$.marked.style.height;
        // let markedWidth = this.$.marked.style.width;
        let markedHeight = '430px';
        let markedWidth = '260px';
        this.$.card.updateStyles({'height': markedHeight});
        this.$.card.updateStyles({'width': markedWidth});     
      }
    }

    window.customElements.define(FeedItem.is, FeedItem);
  </script>
</dom-module>
